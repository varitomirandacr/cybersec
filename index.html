<html>
    <head>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/xml2js@0.6.2/lib/xml2js.min.js"></script>
        <link href="./resources/site.css" rel="stylesheet"/>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                 
                debugger;
                console.log("called from onload");
                fetch('https://api.allorigins.win/raw?url=https://feeds.feedburner.com/TheHackersNews?format=xml')
                .then(response => response.text())
                .then(data => {
                    debugger;
                    const jsonItems = [];
                    xml2js.parseString(data, (err, result) => {
                        console.log("XML STRING: "+JSON.stringify(data));
                        const items = result.rss.channel[0].item;
                        
                        items.forEach(item => {
                        const title = item.title[0];
                        const description = item.description[0];
                        const link = item.link[0];
                        const pubDate = item.pubDate[0];

                        jsonItems.push({title: title, description: description, link: link, pubDate: pubDate });
                        });
                    });
                    let parsed = [];     
                    jsonItems.forEach(el => {
                        parsed.push(`
                        <div class="col-md-4 col-lg-6 d-flex flex-column h-100 p-5 pb-1 text-white text-shadow-1">
                            <div class="cyan-card">
                            <div>
                                <h5 class="card-title cyan-title">${el.title}</h5>
                                <p class="card-text">
                                ${el.description}
                                </p>
                                <a href="${el.link}" class="card-link">Read more</a>
                            </div>
                            <div class="card-footer text-muted">
                                ${el.pubDate}
                            </div>
                            </div>
                        </div>`);
                    }); 
                    document.getElementById('contentPage').innerHTML = parsed.join(''); 
                    console.log(data)
                })
                .catch(error => { console.error('Error fetching message:', error); });

                /*
                .then(response => {
                    console.log(response.text()) ;
                    //console.log(response.json());
                    return response.text();
                })
                .then(data => {
                    document.getElementById('contentPage').innerHTML = data.content;
                    //showHide("page");
                })
                    */

                fetch("./data/data.json")
                    .then(response => response.text())
                    .then(data => {
                        const parsed = JSON.parse(data);
                        let navs = [];
                        parsed.forEach(item => {
                            const nav = `<a href="#" data-url="${item.path}" data-target="${item.category}">
                                            <i class="ph-browsers"></i>
                                            <span>${item.category.replace("_", " ")}</span>
                                        </a>`;
                            navs.push(nav);

                            let tabs = [];
                            item.tabs.forEach(t => {
                                const tab = `<a href="#" data-parent="${item.category}" data-url="${t.path}" class="hidden">${t.category}</a>`;
                                tabs.push(tab);
                            });
                            document.getElementById("horizontal-tabs").innerHTML += tabs.join('');
                            document.querySelectorAll('.tabs a').forEach(tab => {
                                tab.addEventListener('click', function (event) {
                                    event.preventDefault();
                                    fetchRss(event.target.dataset.url, contentPage);
                                });
                            });
                            document.getElementById("sidebar-nav").innerHTML = navs.join('');
                        
                            document.querySelectorAll('.navigation a').forEach(link => {
                                link.addEventListener('click', function (event) {
                                    event.preventDefault();
                                    console.log("called from listener");
                                    const target = event.target;
                                    const url = this.dataset.url;
                                    fetch(url, {
                                        method: 'GET',
                                        headers: {
                                            mode: 'no-cors'
                                        }
                                    })
                                    .then(response => response.text())
                                    .then(content => {
                                        debugger;
                                        if (url.includes(".html")) {                                                    
                                            showHide("page").innerHTML = content;
                                        }
                                        else {
                                            showHide("frame").innerHTML = marked.parse(content);
                                        }
                                    })
                                    .catch(error => console.error('Error loading Markdown file:', error));   
                                    
                                    document.querySelectorAll('.tabs a').forEach(tab => {
                                        let current = target.parentNode.dataset.target;
                                        if(tab.dataset.parent == current)
                                            tab.className.replace("hidden", "show");
                                        else
                                            tab.className.replace("show", "hidden");
                                    });
                                });
                            });                                    
                        })
                    })
                    .catch(error => console.error('Error loading Markdown file:', error));
            });

            function fetchRss(rssUrl, componentId) {
                /*await fetch('http://localhost:3000/api/data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name })
                });*/

                fetch('https://api.allorigins.win/raw?url=https://feeds.feedburner.com/TheHackersNews?format=xml')
                .then(response => {
                    console.log(response.text());
                    return response.text();
                })
                .then(data => {
                    debugger;
                    document.getElementById('contentPage').innerHTML = data.content;                    
                })
                .catch(error => {
                    console.error('Error fetching message:', error);
                });
            }

            function showHide(component) {
                const contentPage = document.getElementById('contentPage');
                const contentFrame = document.getElementById('contentFrame');
                if (component == "page") {
                    contentFrame.style.display = "none";
                    contentPage.style.display = "flex";
                    return contentPage;
                } else {
                    contentFrame.style.display = "block";
                    contentPage.style.display = "none";
                    return contentFrame;
                }
            }
        
        </script>
    </head>
<body>
    <div class="app">
        <header class="app-header">
            <div class="app-header-logo">
                <div class="logo">
                    <h1 class="logo-title">
                        <span>Cybersec</span>
                        <span>wiki</span>
                    </h1>
                </div>
            </div>
            <div class="app-header-navigation">
                <div id="horizontal-tabs" class="tabs">                    
                </div>
            </div>
            <div class="app-header-actions">
                <button class="user-profile">
                    <span>Alvaro A. Miranda</span>
                    <span>
                        <img src="./resources/me.jfif" />
                    </span>
                </button>
                <div class="app-header-actions-buttons">
                    <button class="icon-button large" onclick="window.open('https://www.linkedin.com/in/varitomiranda/', '_blank')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16">
                            <path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225z"/>
                        </svg>
                    </button>
                    <button class="icon-button large" onclick="window.open('https://www.linkedin.com/in/varitomiranda/', '_blank')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-github" viewBox="0 0 16 16">
                            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8"/>
                          </svg>
                    </button>
                </div>
            </div>
            <div class="app-header-mobile">
                <button class="icon-button large">
                    <i class="ph-list"></i>
                </button>
            </div>
        </header>
        <div class="app-body">
            <div class="row">
                <div class="col-md-2">
                    <nav class="navigation" id="sidebar-nav">
                        <!--<a href="#" data-url="./content/linux.md">
                            <i class="ph-browsers"></i>
                            <span>Latest News</span>
                        </a>
                        <a href="#">
                            <i class="ph-check-square"></i>
                            <span>Magazines</span>
                        </a>
                        <a href="#">
                            <i class="ph-swap"></i>
                            <span>CTFs</span>
                        </a>
                        <a href="#">
                            <i class="ph-file-text"></i>
                            <span>Tools</span>
                        </a>
                        <a href="#">
                            <i class="ph-globe"></i>
                            <span>Troubleshooting</span>
                        </a>
                        <a href="#">
                            <i class="ph-globe"></i>
                            <span>Ethickal Hacking</span>
                        </a>
                        <a href="#">
                            <i class="ph-globe"></i>
                            <span>Cloud</span>
                        </a>-->
                    </nav>
                    <footer class="footer">
                        <h1>Almeria<small>©</small></h1>
                        <div>
                            Almeria ©<br />
                            All Rights Reserved 2021
                        </div>
                    </footer>
                </div>
                <div class="col-md-8 custom-scroll">   
                    <div id="mainPage">
                        <div id="contentPage" class="row">
                        </div>
                    </div>                 
                    <object id="contentFrame" data=""></object>
                    <!--
                    <section class="service-section">
                        <h2>Service</h2>
                        <div class="service-section-header">
                            <div class="search-field">
                                <i class="ph-magnifying-glass"></i>
                                <input type="text" placeholder="Account number">
                            </div>
                            <div class="dropdown-field">
                                <select>
                                    <option>Home</option>
                                    <option>Work</option>
                                </select>
                                <i class="ph-caret-down"></i>
                            </div>
                            <button class="flat-button">
                                Search
                            </button>
                        </div>
                        <div class="mobile-only">
                            <button class="flat-button">
                                Toggle search
                            </button>
                        </div>
                        <div class="tiles">
                            <article class="tile">
                                <div class="tile-header">
                                    <i class="ph-lightning-light"></i>
                                    <h3>
                                        <span>Electricity</span>
                                        <span>UrkEnergo LTD.</span>
                                    </h3>
                                </div>
                                <a href="#">
                                    <span>Go to service</span>
                                    <span class="icon-button">
                                        <i class="ph-caret-right-bold"></i>
                                    </span>
                                </a>
                            </article>
                            <article class="tile">
                                <div class="tile-header">
                                    <i class="ph-fire-simple-light"></i>
                                    <h3>
                                        <span>Heating Gas</span>
                                        <span>Gazprom UA</span>
                                    </h3>
                                </div>
                                <a href="#">
                                    <span>Go to service</span>
                                    <span class="icon-button">
                                        <i class="ph-caret-right-bold"></i>
                                    </span>
                                </a>
                            </article>
                            <article class="tile">
                                <div class="tile-header">
                                    <i class="ph-file-light"></i>
                                    <h3>
                                        <span>Tax online</span>
                                        <span>Kharkov 62 str.</span>
                                    </h3>
                                </div>
                                <a href="#">
                                    <span>Go to service</span>
                                    <span class="icon-button">
                                        <i class="ph-caret-right-bold"></i>
                                    </span>
                                </a>
                            </article>
                        </div>
                        <div class="service-section-footer">
                            <p>Services are paid according to the current state of the currency and tariff.</p>
                        </div>
                    </section>

                    <section class="transfer-section">
                        <div class="transfer-section-header">
                            <h2>Latest transfers</h2>
                            <div class="filter-options">
                                <p>Filter selected: more than 100 $</p>
                                <button class="icon-button">
                                    <i class="ph-funnel"></i>
                                </button>
                                <button class="icon-button">
                                    <i class="ph-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="transfers">
                            <div class="transfer">
                                <div class="transfer-logo">
                                    <img src="https://assets.codepen.io/285131/apple.svg" />
                                </div>
                                <dl class="transfer-details">
                                    <div>
                                        <dt>Apple Inc.</dt>
                                        <dd>Apple ID Payment</dd>
                                    </div>
                                    <div>
                                        <dt>4012</dt>
                                        <dd>Last four digits</dd>
                                    </div>
                                    <div>
                                        <dt>28 Oct. 21</dt>
                                        <dd>Date payment</dd>
                                    </div>
                                </dl>
                                <div class="transfer-number">
                                    - $ 550
                                </div>
                            </div>
                            <div class="transfer">
                                <div class="transfer-logo">
                                    <img src="https://assets.codepen.io/285131/pinterest.svg" />
                                </div>
                                <dl class="transfer-details">
                                    <div>
                                        <dt>Pinterest</dt>
                                        <dd>2 year subscription</dd>
                                    </div>
                                    <div>
                                        <dt>5214</dt>
                                        <dd>Last four digits</dd>
                                    </div>
                                    <div>
                                        <dt>26 Oct. 21</dt>
                                        <dd>Date payment</dd>
                                    </div>
                                </dl>
                                <div class="transfer-number">
                                    - $ 120
                                </div>
                            </div>
                            <div class="transfer">
                                <div class="transfer-logo">
                                    <img src="https://assets.codepen.io/285131/warner-bros.svg" />
                                </div>
                                <dl class="transfer-details">
                                    <div>
                                        <dt>Warner Bros.</dt>
                                        <dd>Cinema</dd>
                                    </div>
                                    <div>
                                        <dt>2228</dt>
                                        <dd>Last four digits</dd>
                                    </div>
                                    <div>
                                        <dt>22 Oct. 21</dt>
                                        <dd>Date payment</dd>
                                    </div>
                                </dl>
                                <div class="transfer-number">
                                    - $ 70
                                </div>
                            </div>
                        </div>
                    </section>
                </div>-->
                </div>
                <div class="col-md-2">
                    <section class="payment-section">
                        <h2>New Payment</h2>
                        <div class="payment-section-header">
                            <p>Choose a card to transfer money</p>
                            <div>
                                <button class="card-button mastercard">
                                    <svg width="2001" height="1237" viewBox="0 0 2001 1237" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g id="a624784f2834e21c94a1c0c9a58bbbaa">
                                            <path id="7869b07bea546aa59a5ee138adbcfd5a" d="M1270.57 1104.15H729.71V132.15H1270.58L1270.57 1104.15Z" fill="currentColor"></path>
                                            <path id="b54e3ab4d7044a9f288082bc6b864ae6" d="M764 618.17C764 421 856.32 245.36 1000.08 132.17C891.261 46.3647 756.669 -0.204758 618.09 9.6031e-07C276.72 9.6031e-07 0 276.76 0 618.17C0 959.58 276.72 1236.34 618.09 1236.34C756.672 1236.55 891.268 1189.98 1000.09 1104.17C856.34 991 764 815.35 764 618.17Z" fill="currentColor"></path>
                                            <path id="67f94b4d1b83252a6619ed6e0cc0a3a1" d="M2000.25 618.17C2000.25 959.58 1723.53 1236.34 1382.16 1236.34C1243.56 1236.54 1108.95 1189.97 1000.11 1104.17C1143.91 990.98 1236.23 815.35 1236.23 618.17C1236.23 420.99 1143.91 245.36 1000.11 132.17C1108.95 46.3673 1243.56 -0.201169 1382.15 -2.24915e-05C1723.52 -2.24915e-05 2000.24 276.76 2000.24 618.17" fill="currentColor"></path>
                                        </g>
                                    </svg>
                                </button>
                                <button class="card-button visa active">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="2500" height="2500" viewBox="0 0 141.732 141.732">
                                        <g fill="currentColor">
                                            <path d="M62.935 89.571h-9.733l6.083-37.384h9.734zM45.014 52.187L35.735 77.9l-1.098-5.537.001.002-3.275-16.812s-.396-3.366-4.617-3.366h-15.34l-.18.633s4.691.976 10.181 4.273l8.456 32.479h10.141l15.485-37.385H45.014zM121.569 89.571h8.937l-7.792-37.385h-7.824c-3.613 0-4.493 2.786-4.493 2.786L95.881 89.571h10.146l2.029-5.553h12.373l1.14 5.553zm-10.71-13.224l5.114-13.99 2.877 13.99h-7.991zM96.642 61.177l1.389-8.028s-4.286-1.63-8.754-1.63c-4.83 0-16.3 2.111-16.3 12.376 0 9.658 13.462 9.778 13.462 14.851s-12.075 4.164-16.06.965l-1.447 8.394s4.346 2.111 10.986 2.111c6.642 0 16.662-3.439 16.662-12.799 0-9.72-13.583-10.625-13.583-14.851.001-4.227 9.48-3.684 13.645-1.389z" />
                                        </g>
                                        <path d="M34.638 72.364l-3.275-16.812s-.396-3.366-4.617-3.366h-15.34l-.18.633s7.373 1.528 14.445 7.253c6.762 5.472 8.967 12.292 8.967 12.292z" fill="currentColor" />
                                        <path fill="none" d="M0 0h141.732v141.732H0z" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="payments">
                            <div class="payment">
                                <div class="card green">
                                    <span>01/22</span>
                                    <span>
                                        •••• 4012
                                    </span>
                                </div>
                                <div class="payment-details">
                                    <h3>Internet</h3>
                                    <div>
                                        <span>$ 2,110</span>
                                        <button class="icon-button">
                                            <i class="ph-caret-right-bold"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="payment">
                                <div class="card olive">
                                    <span>12/23</span>
                                    <span>
                                        •••• 2228
                                    </span>
                                </div>
                                <div class="payment-details">
                                    <h3>Universal</h3>
                                    <div>
                                        <span>$ 5,621</span>
                                        <button class="icon-button">
                                            <i class="ph-caret-right-bold"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="payment">
                                <div class="card gray">
                                    <span>03/22</span>
                                    <span>
                                        •••• 5214
                                    </span>
                                </div>
                                <div class="payment-details">
                                    <h3>Gold</h3>
                                    <div>
                                        <span>$ 3,473</span>
                                        <button class="icon-button">
                                            <i class="ph-caret-right-bold"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="faq">
                            <p>Most frequently asked questions</p>
                            <div>
                                <label>Question</label>
                                <input type="text" placeholder="Type here">
                            </div>
                        </div>
                        <div class="payment-section-footer">
                            <button class="save-button" onclick="test()">
                                Save
                            </button>
                            <button class="settings-button">
                                <i class="ph-gear"></i>
                                <span>More settings</span>
                            </button>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>

    
</body>
</html>