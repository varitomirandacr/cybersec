<html lang="en" data-bs-theme="dark">    
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/xml2js@0.6.2/lib/browser/xml2js.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/fast-xml-parser@4.0.12/dist/parser.min.js"></script>

        <link href="./resources/site.css" rel="stylesheet"/>
        <link href="./resources/sidebar.css" rel="stylesheet"/>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                 
                async function fetchNews() {
                    try {
                        const response = await fetch('https://newsdata.io/api/1/news?apikey=pub_48290aed27ff3a224875151ae01fc6a504c03&q=cybersecurity');
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        const articles = await response.json();
                        document.getElementById('contentPage').innerHTML = '';
                        articles.results.forEach(el => {
                            if (el.language == "english") {
                                document.getElementById('contentPage').innerHTML += `
                                    <div class="col-md-4 col-lg-6 d-flex flex-column p-5 pb-1 text-white text-shadow-1">
                                        <div class="cyan-card">
                                        <div>
                                            <h5 class="card-title cyan-title">${el.title}</h5>
                                            <p class="card-text cut-text">
                                            ${el.description || ''}
                                            </p>
                                            <a href="${el.link}" class="card-link">Read more</a>
                                        </div>
                                        <div class="card-footer text-muted">
                                            ${el.pubDate}
                                        </div>
                                        </div>
                                    </div>`;
                            }
                        });
                    } catch (error) {
                        console.error('Error fetching news:', error);
                        document.getElementById('news-container').innerText = 'Error fetching news';
                    }
                }

                fetch("./data/data.json")
                    .then(response => response.text())
                    .then(data => {
                        const parsed = JSON.parse(data);
                        parsed.forEach(item => {

                            document.getElementById("sidebar-nav").innerHTML += `<a href="#" data-url="${item.path}" data-target="${item.category}">
                                            <i class="ph-browsers"></i>
                                            <span>${item.category.replace("_", " ")}</span>
                                        </a>`;

                            item.tabs.forEach(t => {
                                document.getElementById("horizontal-tabs").innerHTML +=
                                `<li class="nav-item">
                                    <a href="#" data-parent="${item.category}" data-path="${t.path}" data-name="${t.category}" aria-current="page" class="nav-link hidden">${t.category}</a>
                                </li>`;
                            });

                            document.querySelectorAll('.nav-tabs a').forEach(tab => {
                                tab.addEventListener('click', function (event) {
                                    event.preventDefault();
                                    const current = event.target;
                                    const dataset = current.dataset;
                                    if (dataset.parent == "News")
                                        fetchNews();
                                    else if (dataset.name == "Tools")
                                        fetchTools(dataset.path);
                                    else if (dataset.name == "Practice")
                                        fetchPractice(dataset.path);
                                    else if (dataset.path.includes('.md'))
                                        fetchMarkdown(dataset.path);
                                    else if (dataset.name == "Pathway")
                                        fetchPathway(dataset.path);
                                });
                            });
                        
                            document.querySelectorAll('.navigation a').forEach(link => {
                                
                                link.addEventListener('click', function (event) {
                                    let current = '';
                                    event.preventDefault();
                                    const target = event.target;                                    
                                    document.querySelectorAll('.nav-tabs a').forEach(tab => {
                                        current = target.parentNode.dataset;
                                        if(tab.dataset.parent == current.target)
                                            tab.classList.replace("hidden", "show");
                                        else
                                            tab.classList.replace("show", "hidden");
                                    });

                                    const _type = current.url.includes('.md') ? 'no-page' : 'page';
                                    if (_type === 'page') {
                                        if(current.target == "Magazines") {
                                            fetchMags(current.url);
                                        }
                                        else {                                           
                                            document.getElementById('contentPage').innerHTML = fetchHtml(current.url);
                                        }
                                    }
                                    else {
                                        fetchMarkdown(current.url);
                                    }
                                });                                
                            });                                    
                        })
                    })
                    .catch(error => console.error('Error loading Markdown file:', error));

                async function fetchJobs() {
                    await fetchServer('./data/search_jobs.json')
                    .then(json => {
                        const jobs = [];
                        json.forEach(job => {
                        jobs.push(`<li class="list-group-item bg-dark text-white"> 
                            <span> ${job.icon} </span>
                            <a href="${job.url}"> ${job.site} </a>
                            </li>`);
                        });
                        document.getElementById('search-jobs').innerHTML = jobs.join('');
                    })
                    .catch(error => console.error('Error loading Markdown file:', error));
                }
                fetchJobs();
            });

            async function fetchPathway(url) {
                await fetchServer(url)
                    .then(json => {
                        const title = `<div class="container"> 
                                            <h1>${json.title}</h1>
                                            <p class="pb-3 mb-0 small lh-sm">${json.description}</p>
                                            <p class="last-updated"> ${new Date()} </p>
                                        </div><hr/>`;
                        document.getElementById('contentPage').innerHTML = `${title} ${json.content}`;
                    })
            }

            async function fetchPractice(url) {
                await fetchServer(url)
                    .then(json => {
                        const tools = [];
                        const title = `<div class="container"> 
                                            <h1>${json.title}</h1>
                                            <p class="pb-3 mb-0 small lh-sm">${json.description}</p>
                                            <p class="last-updated"> ${new Date()} </p>
                                        </div><hr/>`;
                        json.tools.forEach(tool => {
                            tools.push(`<article class="col-md-4 pb-3">
                                            <div class="">
                                                <img src="${tool.image}" />
                                                <h3><span>${tool.name}</span></h3>                                                                                             
                                            </div>
                                            <div><span class="pb-3 mb-0 small lh-sm">${tool.description}</span></div>
                                            <a class="card-link" href="${tool.url}" target="_blank">
                                                <span>View page</span>
                                            </a>
                                        </article>`);
                        });
                        document.getElementById('contentPage').innerHTML = `${title} ${tools.join('')}`;
                    })
            }

            async function fetchTools(url) {
                await fetchServer(url)
                    .then(json => {
                        const tools = [];
                        const title = `<div class="container"> 
                                            <h1>${json.title}</h1>
                                            <p class="pb-3 mb-0 small lh-sm">${json.description}</p>
                                            <p class="last-updated"> ${new Date()} </p>
                                        </div><hr/>`;
                        json.tools.forEach(tool => {
                            tools.push(`<article class="col-md-6 pb-3">
                                            <div class="">
                                                <img src="${tool.image}" />
                                                <h3><span>${tool.name}</span></h3>                                                                                             
                                            </div>
                                            <div><span class="pb-3 mb-0 small lh-sm">${tool.description}</span></div>
                                            <a class="card-link" href="${tool.url}" target="_blank">
                                                <span>View page</span>
                                            </a>
                                        </article>`);
                        });
                        debugger;
                        document.getElementById('contentPage').innerHTML = '';
                        document.getElementById('contentPage').innerHTML = `${title} ${tools.join('')}`;
                    })
            }

            async function fetchMags(url) {
                await fetchServer('./content/magazines/magazines.json')
                    .then(json => {
                        const mags = [];
                        const title = `<div class="container"> 
                            <h1>${json.title}</h1>
                            <p class="pb-3 mb-0 small lh-sm card-bottom">${json.description}</p>
                            <p class="last-updated"> ${new Date()} </p>
                        </div>`;
                        json.magazines.forEach(mag => {
                            mags.push(`<!-- ${mag.name} -->
                                <div class="col-md-4">
                                    <div class="d-flex text-body-secondary pt-3">
                                        <div class="card-container">
                                            <h4 class="card-title">${mag.name}</h4>
                                            <p class="pb-3 mb-0 small lh-sm card-bottom">${mag.description}</p>
                                            <a href="${mag.url}" class="card-link" target="_blank">Visit Website</a>
                                        </div>
                                    </div>
                                </div>`);
                        document.getElementById('contentPage').innerHTML = `${title} ${mags.join('')}`;
                    });
                });
            }

            async function fetchServer(url) {
                    try {
                        const response = await fetch(url);
                        if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return await response.json();
                    } catch (error) {
                        console.error('Error fetching news:', error);
                        document.getElementById('news-container').innerText = 'Error fetching news';
                    }
                }

            async function fetchMarkdown(url) {
                fetch(url)
                    .then(response => response.text())
                    .then(markdown => {
                        const html = marked.parse(markdown);
                        document.getElementById('contentPage').innerHTML = html; 
                    })
                    .catch(error => console.error('Error loading Markdown file:', error));
            }

            async function fetchHtml(url) {
                await fetchServer(url)
                    .then(response => {
                        document.getElementById('contentPage').innerHTML = response.content; 
                    })
                    .catch(error => console.error('Error loading Markdown file:', error));
            }
        
        </script>
    </head>
<body>
    <div class="app">
        <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <div class="app-header-logo">
                        <div class="logo">
                            <h3 class="logo-title">
                                <span>Cybersec</span>
                                <span></span>
                            </h3><h6><span>wiki</span></h6>
                        </div>
                    </div>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse justify-content-end" id="collapsibleNavbar">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <button class="user-profile">
                                    <span>Alvaro A. Miranda</span>
                                    <span>
                                        <img src="./resources/me.jfif" />
                                    </span>
                                </button>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <button class="icon-button large" onclick="window.open('https://www.linkedin.com/in/varitomiranda/', '_blank')">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16">
                                        <path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225z"/>
                                    </svg>
                                </button>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <button class="icon-button large" onclick="window.open('https://github.com/varitomirandacr/', '_blank')">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-github" viewBox="0 0 16 16">
                                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8"/>
                                      </svg>
                                </button>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="app-body mb-3">
           
            <div class="row">

                <div class="col-sm-12 col-md-2 col-lg-2 mb-3">
                    <div class="navigation" data-bs-theme="dark" id="sidebar-nav"></div>
                </div>

                <div class="col-sm-12 col-md-8 col-lg-8 custom-scroll mb-3">  
                    <div class="row">
                        <ul class="nav nav-tabs" id="horizontal-tabs"></ul>
                    </div> 
                    <div class="row">
                            <div id="contentPage" class="row">
                        </div>                 
                    </div>                    
                </div>

                <div class="col-sm-12 col-md-2 col-lg-2">
                    <h3>Search Jobs</h3>
                    <ul class="list-group list-group-flush bg-dark text-white" id="search-jobs">
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="footer sticky-footer border-top" data-bs-theme="dark">
        AAMM ©<br />
        CyberWiki 2024
    </div>
    <script src="https://cdn.jsdelivr.net/npm/fast-xml-parser@4.0.12/dist/parser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fast-xml-parser/4.4.0/fxparser.min.js"></script>
</body>
</html>